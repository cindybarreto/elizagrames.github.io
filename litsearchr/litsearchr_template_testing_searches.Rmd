---
title: "Template for using litsearchr to test search strategies"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

# Step 1: Determine which articles should be returned

Save the titles of the articles you want to retrieve as a character vector called gold_standard. You may want to do this by reading in a .csv file or you can paste/type them out.

```{r}
gold_standard <- c()
```

Now run the chunk of code below. It will output a Boolean search of title keywords to your working directory. 

```{r}

title_search <- litsearchr::write_title_search(titles=gold_standard)

writeLines(title_search, "./title_search.txt")

dir.create("./title_hits/")

```

Run the title searches in all the databases you plan to use. This way, you know if the articles are actually indexed in those databases and could be found by your search strategy. Save the output of these searches in the directory ./title_hits/ which is in your current working directory. 

```{r}
title_search <- litsearchr::import_results(directory="./title_hits/", 
                                         remove_duplicates = TRUE, 
                                         clean_dataset = FALSE)

articles_found <- litsearchr::check_recall(true_hits = gold_standard, retrieved_articles = title_search$title)
write.csv(articles_found, "./articles_found.csv")

```

Check the articles_found.csv file and manually review it to see which are good hits. Save these titles as the new quasi-gold standard (qgs) variable below. These are the articles that you want your search strategy to find. 

```{r}
qgs <- c()
```

# Step 2: Run your searches and check recall

Set up a data frame with the databases you are testing your search strategy in. Run your search strategy for each database, then mark down the total hits (in order) for databases$total_hits in the code below and run it. 

```{r}
databases <- data.frame(database=rbind("BIOSIS", "ZoologicalRecord", "MEDLINE", "Scopus", "AcademicSearchPremier"))
databases$total_hits <- c()

dir.create("./search_hits/")

```

To see if your searches retrieve the quasi-gold standard articles, repeat them but add the requirement that they must also contain the title_search.txt terms. For example, in any Web of Science database, you would add a row for "Title" and then paste the title_search terms there. Check the tutorial about how to use litsearchr to test a search strategy for more details. 

Save these results to the "./search_hits/" directory. Then run the code below.

```{r}
my_search <- litsearchr::import_results(directory="./search_hits/", remove_duplicates=TRUE, clean_dataset=FALSE)

search_test <- litsearchr::check_recall(true_hits = qgs, retrieved_articles = my_search$title)

write.csv(search_test, "./search_test_hits.csv")
```

Open the search_test_hits.csv and delete any rows that are not actually good hits when reviewed manually. Save it as "./search_test_checked.csv"

# Step 3: Get search performance metrics

Run the code below. It will print (to the console) the search strategy sensitivity (recall), precision (specificity), and number needed to process to find one relevant article.

```{r}
checked_search <- read.csv("./search_test_checked.csv")

litsearchr::search_performance(no_desired = length(qgs), no_hits = nrow(checked_search), no_articles = sum(databases$total_hits))

```

